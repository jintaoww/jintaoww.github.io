<script src="{{ base_path }}/assets/js/main.min.js"></script>

{% include analytics.html %}
{% include /comments-providers/scripts.html %}

<!-- Live2D 插件（从 CDN 加载） -->
<script src="https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.min.js"></script>

<script>
  const modelMap = {
    light: {
      model: "hijiki",
      cdn: "https://cdn.jsdelivr.net/npm/live2d-widget-model-hijiki/assets/"
    },
    dark: {
      model: "tororo",
      cdn: "https://cdn.jsdelivr.net/npm/live2d-widget-model-tororo/assets/"
    }
  };

  function switchLive2D(theme) {
    const info = modelMap[theme];
    if (!info) return;

    if (window.L2Dwidget) {
      window.L2Dwidget.dispose();
    }

    L2Dwidget.init({
      model: {
        jsonPath: `${info.cdn}model.json`
      },
      display: {
        position: "right",
        width: 150,
        height: 300,
        hOffset: 0,
        vOffset: -20
      },
      mobile: { show: true },
      react: { opacityDefault: 0.9, opacityOnHover: 0.2 }
    });
  }

  function switchTheme() {
    const html = document.documentElement;
    const current = html.getAttribute("data-theme") || "light";
    const next = current === "light" ? "dark" : "light";
    html.setAttribute("data-theme", next);
    switchLive2D(next);
  }

  document.addEventListener("DOMContentLoaded", () => {
    const toggle = document.getElementById("theme-toggle");
    if (toggle) toggle.addEventListener("click", switchTheme);

    const theme = document.documentElement.getAttribute("data-theme") || "light";
    switchLive2D(theme);
  });
</script>